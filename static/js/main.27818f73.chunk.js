(this["webpackJsonpbeets-ui"]=this["webpackJsonpbeets-ui"]||[]).push([[0],{161:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(22),u=n.n(s),l=(n(84),n(53)),c=n(185),i=n(75),o=n(10),m=n(181),f=n(182),d=n(74),g=n(188),b=n(192),p=n(195),y=n(9),h=n.n(y),E=n(15),v=n(27),w=n(71),S=function e(t){var n=this;Object(w.a)(this,e),this.getAlbums=function(){var e=Object(E.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k(t)?"/album/query/"+t:"/album",e.next=3,n.makeRequest(a).then((function(e){return k(t)?e.results:e.albums}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteAlbums=function(){var e=Object(E.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.makeRequest("/album/"+t.map((function(e){return e.toString()})).join(","),"DELETE");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTracks=function(){var e=Object(E.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t&&""!==t?"/item/query/"+t:"/item",e.next=3,n.makeRequest(a).then((function(e){return k(t)?e.results:e.items}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteTracks=function(){var e=Object(E.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.makeRequest("/item/"+t.map((function(e){return e.toString()})).join(","),"DELETE");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getStats=Object(E.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.makeRequest("/stats");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),this.makeRequest=function(){var e=Object(E.a)(h.a.mark((function e(t,a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.settings){e.next=2;break}throw new Error("Settings not yet initialised");case 2:return a=a||"GET",e.abrupt("return",fetch(n.settings.url+t,{method:a,headers:n.settings.basicAuth?{Authorization:"Basic "+btoa(n.settings.basicAuth.username+":"+n.settings.basicAuth.password)}:{}}).then((function(e){return e.json()})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.settings=t.global.settings.settings},k=function(e){return e&&""!==e},x="QUERY_ALBUMS",O="QUERY_TRACKS",q="NOT_RUN",C="LOADING",T="ERROR",j="SUCCESS",A=Object(v.b)({name:"query",initialState:{queryState:{state:C,warnings:[],resultType:x},beetsQuery:"",nextQueryType:x,resultSelected:null,filterString:null,deleteOnDisk:!0},reducers:{resultsLoaded:function(e,t){e.queryState={state:j,results:t.payload,resultType:e.nextQueryType}},resultsDeleted:function(e,t){e.queryState.results=e.queryState.results.filter((function(e){return!t.payload.includes(e.id)}))},clearQuery:function(e){e.resultSelected=null,e.filterString=null,e.queryState={state:q}},loadError:function(e,t){e.queryState={state:T,error:t.payload}},startLoading:function(e,t){e.queryState={state:C,warnings:""===e.beetsQuery?["This query may take a long time. Try making it more specific before searching."]:[]}},changeFilterString:function(e,t){e.filterString=""===t.payload?null:t.payload},changeNextQueryType:function(e,t){e.nextQueryType=t.payload},changeBeetsQuery:function(e,t){e.beetsQuery=t.payload},changeResultSelected:function(e,t){e.resultSelected=t.payload},changeDeleteOnDisk:function(e,t){e.deleteOnDisk=t.payload}}}),R=A.actions,L=R.resultsLoaded,D=R.resultsDeleted,Q=R.loadError,B=R.clearQuery,U=R.changeFilterString,I=R.changeNextQueryType,N=R.changeBeetsQuery,Y=R.changeResultSelected,P=R.changeDeleteOnDisk,z=R.startLoading,_=function(){return function(){var e=Object(E.a)(h.a.mark((function e(t,n){var a,r,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t(z()),a=n(),r=new S(a),a.query.nextQueryType!==x){e.next=10;break}return e.next=7,r.getAlbums(a.query.beetsQuery);case 7:s=e.sent,e.next=13;break;case 10:return e.next=12,r.getTracks(a.query.beetsQuery);case 12:s=e.sent;case 13:t(L(s)),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0),t(Q(e.t0.message));case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}()},F=function(e){return e.query.queryState.state!==j?null:e.query.filterString?e.query.queryState.results.filter((function(t){return G(t,e.query.filterString.toLowerCase(),e.query.queryState.resultType)})):e.query.queryState.results},G=function(e,t,n){switch(n){case x:return e.album.toLowerCase().includes(t)||e.albumartist.toLowerCase().includes(t);case O:default:return e.album.toLowerCase().includes(t)||e.artist.toLowerCase().includes(t)||e.title.toLowerCase().includes(t)}},H=function(e){return e.query.queryState},J=function(e){return e.query.queryState.resultType},M=function(e){return e.query.nextQueryType},K=function(e){return e.query.beetsQuery},W=function(e){return e.query.queryState.state===j?e.query.queryState.results.find((function(t){return t.id===e.query.resultSelected})):null},$=A.reducer,V=n(179);function X(e){var t=e.label,n=e.value;return r.a.createElement(V.a,null,r.a.createElement("span",{style:{"font-weight":"bold","padding-right":"1em"}},t),n||"Unknown")}function Z(){var e=Object(o.c)(F),t=Object(o.c)(H),n=Object(o.c)(J),s=Object(o.c)(M),u=Object(o.c)(K),c=Object(o.c)(W),b=Object(o.c)((function(e){return e.query.deleteOnDisk})),p=Object(o.b)();return function(e){var t=Object(o.b)();Object(a.useEffect)((function(){t(e())}),[t,e])}(_),r.a.createElement(l.a,null,r.a.createElement(l.a,{marginBottom:24},r.a.createElement(m.a,{value:s,onChange:function(e){return p(I(e.target.value))}},r.a.createElement("option",{value:"QUERY_ALBUMS",selected:!0},"Albums"),r.a.createElement("option",{value:"QUERY_TRACKS"},"Tracks")),r.a.createElement(f.a,{placeholder:"Beets query...",value:u,onChange:function(e){return p(N(e.target.value))},marginRight:8}),r.a.createElement(i.a,{onClick:function(){return p(_())},disabled:t.state===C,isLoading:t.state===C},"Run query")),r.a.createElement("hr",null),t.state===j&&r.a.createElement(l.a,{paddingBottom:16},r.a.createElement(d.a,{intent:"success",title:"Query returned "+e.length+" results."}),r.a.createElement(l.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(i.a,{onClick:function(){return p(B())},marginRight:16},"Clear query"),r.a.createElement(l.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(i.a,{onClick:function(){return p(function(){var e=Object(E.a)(h.a.mark((function e(t,n){var a,r,s,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=n(),r=new S(a),s=a.query.queryState.results.map((function(e){return e.id})),a.query.nextQueryType!==x){e.next=10;break}return e.next=7,r.deleteAlbums(s,a.query.deleteOnDisk);case 7:u=e.sent,e.next=13;break;case 10:return e.next=12,r.deleteTracks(s,a.query.deleteOnDisk);case 12:u=e.sent;case 13:u.deleted?t(D(s)):t(Q("Could not delete results of query")),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0),t(Q(e.t0.message));case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}())},marginRight:16,intent:"danger"},"Remove all"),r.a.createElement(g.a,{label:"Also delete files on disk",checked:b,onChange:function(e){return p(P(e.target.checked))}})))),r.a.createElement(ee,{queryState:t}),r.a.createElement(re,{result:c,queryType:n}))}function ee(e){var t=e.queryState;switch(t.state){case C:return r.a.createElement(a.Fragment,null,r.a.createElement(d.a,{intent:"none",title:"Running query..."}),t.warnings.map((function(e,t){return r.a.createElement(d.a,{key:t,intent:"warning",title:e,marginTop:8})})));case T:return r.a.createElement(d.a,{intent:"danger",title:t.error});case j:return r.a.createElement(b.a,null,r.a.createElement(te,{labels:t.resultType===x?["Artist","Year"]:["Artist","Album","Year"]}),r.a.createElement(b.a.Body,null,t.results.map((function(e){return t.resultType===x?r.a.createElement(ne,{key:e.id,album:e}):r.a.createElement(ae,{key:e.id,track:e})}))));case q:default:return r.a.createElement(d.a,{intent:"none",title:"Enter a query above to see results"})}}function te(e){var t=e.labels,n=Object(o.b)();return r.a.createElement(b.a.Head,null,r.a.createElement(b.a.SearchHeaderCell,{onChange:function(e){return n(U(e))}}),t.map((function(e){return r.a.createElement(b.a.TextHeaderCell,{key:e},e)})))}function ne(e){var t=e.album,n=Object(o.b)();return r.a.createElement(b.a.Row,{isSelectable:!0,onSelect:function(){return n(Y(t.id))}},r.a.createElement(b.a.TextCell,null,t.album),r.a.createElement(b.a.TextCell,null,t.albumartist),r.a.createElement(b.a.TextCell,{isNumber:!0},t.year))}function ae(e){var t=e.track,n=Object(o.b)();return r.a.createElement(b.a.Row,{isSelectable:!0,onSelect:function(){return n(Y(t.id))}},r.a.createElement(b.a.TextCell,null,t.title),r.a.createElement(b.a.TextCell,null,t.artist),r.a.createElement(b.a.TextCell,null,t.album),r.a.createElement(b.a.TextCell,{isNumber:!0},t.year))}function re(e){var t=e.queryType,n=e.result,a=Object(o.b)();return r.a.createElement(p.a,{isShown:!!n,title:t===x?"Album":"Track",onCloseComplete:function(){return a(Y(null))},confirmLabel:"Done"},n?t===x?r.a.createElement("div",null,r.a.createElement(c.a,{size:600,marginBottom:8},n.album," (",n.year,")"),r.a.createElement(c.a,{size:500,marginBottom:16},n.albumartist),r.a.createElement(X,{label:"Genre",value:n.genre}),r.a.createElement(X,{label:"Country",value:n.country}),r.a.createElement(X,{label:"Label",value:n.label})):r.a.createElement("div",null,r.a.createElement(c.a,{size:600,marginBottom:8},n.title," (",n.year,")"),r.a.createElement(c.a,{size:500,marginBottom:16},n.artist,", ",n.album),r.a.createElement(X,{label:"Genre",value:n.genre}),r.a.createElement(X,{label:"Country",value:n.country}),r.a.createElement(X,{label:"Label",value:n.label})):r.a.createElement("div",null))}var se=Object(v.b)({name:"stats",initialState:{results:null},reducers:{resultsLoaded:function(e,t){e.results=t.payload}}}),ue=se.actions.resultsLoaded,le=function(){return function(){var e=Object(E.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new S(n()).getStats();case 3:a=e.sent,t(ue(a)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},ce=function(e){return e.stats.results},ie=se.reducer;function oe(){var e=Object(o.c)(ce);return function(e){var t=Object(o.b)();Object(a.useEffect)((function(){t(e())}),[t,e])}(le),e?r.a.createElement("div",null,r.a.createElement(X,{label:"Albums",value:e.albums}),r.a.createElement(X,{label:"Tracks",value:e.items})):r.a.createElement(V.a,null,"Loading stats...")}var me=n(193),fe=n(183),de=n(191),ge="PRESENT",be="ABSENT",pe=Object(v.b)({name:"global",initialState:{settings:xe(),showSettings:!1},reducers:{settingsChanged:function(e,t){e.settings={state:ge,settings:t.payload},e.showSettings=!1},showSettingsDialog:function(e){e.showSettings=!0},hideSettingsDialog:function(e){e.showSettings=!1}}}),ye=pe.actions,he=ye.settingsChanged,Ee=ye.showSettingsDialog,ve=ye.hideSettingsDialog,we=function(e){return e.global.settings.state===ge},Se=function(e){return e.global.settings.state===be||e.global.showSettings},ke=pe.reducer;function xe(){var e=localStorage.getItem("beets:settings");return e?{state:ge,settings:JSON.parse(e)}:{state:be,settings:null}}function Oe(e){localStorage.setItem("beets:settings",JSON.stringify(e.settings))}var qe="SUCCESS",Ce="FAILED",Te="NOT_RUN",je=Object(v.b)({name:"settings",initialState:{url:"",basicAuthEnabled:!1,username:"",password:"",test:{status:Te}},reducers:{changeUrl:function(e,t){e.url=t.payload,e.test={status:Te}},changeBasicAuthEnabled:function(e,t){e.basicAuthEnabled=t.payload,e.test={status:Te}},changeUsername:function(e,t){e.username=t.payload,e.test={status:Te}},changePassword:function(e,t){e.password=t.payload,e.test={status:Te}},completedTest:function(e,t){t.payload.result?e.test={status:qe}:e.test={status:Ce,error:t.payload.err}}}}),Ae=je.actions,Re=Ae.changeUrl,Le=Ae.changeBasicAuthEnabled,De=Ae.changeUsername,Qe=Ae.changePassword,Be=Ae.completedTest,Ue=function(e){return e.settings.basicAuthEnabled},Ie=function(e){return{url:e.settings.url,basicAuthEnabled:e.settings.basicAuthEnabled,username:e.settings.username,password:e.settings.password}},Ne=function(e){return""===e.settings.url||e.settings.basicAuthEnabled&&""===e.settings.username?null:{url:e.settings.url,basicAuth:e.settings.basicAuthEnabled?{username:e.settings.username,password:e.settings.password}:null}},Ye=function(e){return e.settings.test},Pe=je.reducer;function ze(e){var t=e.isShown,n=e.canClose,a=Object(o.c)(Ie),s=Object(o.c)(Ne),u=Object(o.c)(Ue),l=Object(o.c)(Ye),c=Object(o.b)();return r.a.createElement(p.a,{title:"Settings",isShown:t,hasClose:n,shouldCloseOnEscapePress:n,shouldCloseOnOverlayClick:n,isConfirmDisabled:!s||l.status!==qe,onConfirm:function(){return c((e=s,function(){var t=Object(E.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{Oe({settings:e}),n(he(e))}catch(a){console.error(a)}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));var e},onOpenComplete:function(){return c(function(){var e=Object(E.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=xe(),t(Re(n.settings.url)),n.settings.basicAuth?(t(Le(!0)),t(Qe(n.settings.password)),t(De(n.settings.username))):t(Le(!1))}catch(a){console.error(a)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},onCloseComplete:function(){return c(ve())}},r.a.createElement("div",null,r.a.createElement(me.a,{label:"Beets URL",description:"The URL of your Beets API instance. Include the protocol and port",placeholder:"http://localhost:8000",value:a.url,onChange:function(e){return c(Re(e.target.value))}}),r.a.createElement(g.a,{checked:a.basicAuthEnabled,onChange:function(e){return c(Le(e.target.checked))},label:"Enable HTTP basic authentication?"}),u&&r.a.createElement(me.a,{label:"Username",description:"Your basic authentication username",placeholder:"admin",value:a.username,onChange:function(e){return c(De(e.target.value))}}),u&&r.a.createElement(me.a,{label:"Password",description:"Your basic authentication password",placeholder:"password123",value:a.password,onChange:function(e){return c(Qe(e.target.value))}})),r.a.createElement(i.a,{disabled:!s,onClick:function(){return c(function(){var e=Object(E.a)(h.a.mark((function e(t,n){var a,r,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Ne(n()),r=new S({global:{settings:{settings:a}}}),e.next=5,r.getStats();case 5:s=e.sent,t(Be(s?{result:!0}:{result:!1,err:"Could not connect"})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),t(Be({result:!1,err:e.t0.message}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}())},marginBottom:16},"Test connection"),r.a.createElement(_e,{status:l}))}function _e(e){var t=e.status;switch(t.status){case qe:return r.a.createElement(l.a,{display:"flex",alignItems:"center"},r.a.createElement(fe.a,{color:"success",marginRight:8}),r.a.createElement(V.a,null,"Connection successful"));case Ce:return r.a.createElement(l.a,{display:"flex",alignItems:"center"},r.a.createElement(de.a,{color:"danger",marginRight:8}),r.a.createElement(V.a,null,"Connection failed: ",t.error));case Te:default:return r.a.createElement(V.a,null)}}var Fe=function(){var e=Object(o.c)(Se),t=Object(o.c)(we),n=Object(o.b)();return r.a.createElement(l.a,{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},r.a.createElement(l.a,{display:"flex",background:"tint2",borderRadius:3,width:"100%",padding:16,justifyContent:"space-between"},r.a.createElement(l.a,{flex:1,alignItems:"center",display:"flex"},r.a.createElement(c.a,{size:600},"Beets UI")),r.a.createElement(l.a,{display:"flex"},t&&r.a.createElement(oe,null),r.a.createElement(i.a,{onClick:function(){return n(Ee())},marginLeft:16},"Settings"))),r.a.createElement(l.a,{width:"100%",padding:16},t&&r.a.createElement(Z,null)),r.a.createElement(ze,{isShown:e,canClose:t}))},Ge=Object(v.a)({reducer:{query:$,stats:ie,settings:Pe,global:ke}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a,{store:Ge},r.a.createElement(Fe,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},79:function(e,t,n){e.exports=n(161)},84:function(e,t,n){}},[[79,1,2]]]);
//# sourceMappingURL=main.27818f73.chunk.js.map